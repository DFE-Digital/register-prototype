{% set isInternational = degree.isInternational | falsify %}

{% set degreeDetailsRows = [
  {
    key: {
      text: "Degree type" if not isInternational else "Comparable UK degree"
    },
    value: {
      text: degree.type or 'Not provided'
    },
    actions: {
      items: [
        {
          href: recordPath + "/degree/" + loop.index0 + "/details" | addReferrer(referrer),
          text: "Change",
          visuallyHiddenText: "degree type"
        }
      ]
    } if canAmend
  },
  {
    key: {
      text: "Subject"
    },
    value: {
      text: degree.subject or 'Not provided'
    },
    actions: {
      items: [
        {
          href: recordPath + "/degree/" + loop.index0 + "/details" | addReferrer(referrer),
          text: "Change",
          visuallyHiddenText: "degree subject"
        }
      ]
    } if canAmend
  }] %}

{% set degreeInstitutionRow = {
    key: {
      text: "Institution"
    },
    value: {
      text: degree.org or 'Not provided'
    },
    actions: {
      items: [
        {
          href: recordPath + "/degree/" + loop.index0 + "/details" | addReferrer(referrer),
          text: "Change",
          visuallyHiddenText: "degree institution"
        }
      ]
    } if canAmend
  } %}

{% if degree.isInternational == 'false' %}
  {% set degreeDetailsRows = degreeDetailsRows | push(degreeInstitutionRow) %}
{% endif %}

{% set degreeCountryRow = {
  key: {
    text: "Country"
  },
  value: {
    text: degree.country or "Not provided"
  },
  actions: {
    items: [
      {
        href: recordPath + "/degree/" + loop.index0 + "/details" | addReferrer(referrer),
        text: "Change",
        visuallyHiddenText: "degree country"
      }
    ]
  } if canAmend
} %}

{# Country only relevant for international #}
{% if isInternational %}
  {% set degreeDetailsRows = degreeDetailsRows | push(degreeCountryRow) %}
{% endif %}

{% set degreeYears = [{
  key: {
    text: "Start year"
  },
  value: {
    text: degree.startDate or "Not provided"
  },
  actions: {
    items: [
      {
        href: recordPath + "/degree/" + loop.index0 + "/details" | addReferrer(referrer),
        text: "Change",
        visuallyHiddenText: "degree start year"
      }
    ]
  } if canAmend
} if false,
{
  key: {
    text: "Graduation year"
  },
  value: {
    text: degree.endDate or "Not provided"
  },
  actions: {
    items: [
      {
        href: recordPath + "/degree/" + loop.index0 + "/details" | addReferrer(referrer),
        text: "Change",
        visuallyHiddenText: "degree graduation year"
      }
    ]
  } if canAmend
}] %}

{% set degreeDetailsRows = degreeDetailsRows | combineArrays(degreeYears) %}

{% set gradeRow = {
  key: {
    text: "Grade"
  },
  value: {
    text: degree.grade or "Not provided"
  },
  actions: {
    items: [
      {
        href: recordPath + "/degree/" + loop.index0 + "/details" | addReferrer(referrer),
        text: "Change",
        visuallyHiddenText: "degree grade"
      }
    ]
  } if canAmend
} %}

{# Grade not relevant for international #}
{% if not isInternational %}
  {% set degreeDetailsRows = degreeDetailsRows | push(gradeRow) %}
{% endif %}


{% set degreeDetailsHtml %}
  {{ govukSummaryList({
    rows: degreeDetailsRows
  }) }}
{% endset %}

{# Generate title text for card #}
{% if isInternational %}
  {% if degree.type != 'NARIC not provided' %}
    {% set typeText = "Non-UK " + degree.type + ": " %}
  {% else %}
      {% set typeText = "Non-UK degree: " %}
  {% endif %}
  {% set titleText = typeText + (degree.subject | lower) %}
{% else %}
  {% set titleText = degree.type + ": " + (degree.subject | lower) %}
{% endif %}


{{ appSummaryCard({
  classes: "govuk-!-margin-bottom-6",
  titleText: titleText,
  actions: {
    items: [{
      href: recordPath + "/degree/" + loop.index0 + "/delete" | addReferrer(referrer),
      text: "Delete degree"
    }]
  } if canAmend,
  html: degreeDetailsHtml
}) }}

