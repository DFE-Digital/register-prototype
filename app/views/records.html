{% extends "_templates/_page.html" %}
{% set pageHeading = "Trainee teachers" %}

{% set backLink = 'false' %}

{% block content %}
{{super()}}
<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds-from-desktop">

    <h1 class="govuk-heading-xl">{{pageHeading}}</h1>
    <div class="records-header">
      {{ govukButton({
        text: "Add a trainee",
        href: "./new-record/new",
        isStartButton: true
      }) }}

      {# {{ govukSelect({
        id: "sort",
        name: "sort",
        label: {
          text: "Sort by"
        },
        items: [
          {
            value: "published",
            text: "Recently added"
          },
          {
            value: "updated",
            text: "Recently updated",
            selected: true
          }
        ]
      }) }} #}
    </div>
  </div>
</div>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">

    <div class="moj-filter-layout">
      
      <form method="get" action="">
      
        <div class="moj-filter-layout__filter">
          {% include "_includes/filter-panel.njk" %}
        </div>

        <div class="moj-filter-layout__content">

          <div class="moj-action-bar">
            <div class="moj-action-bar__filter"></div>
          </div>
          
          <div class="records-search">
            {{ govukInput({
              label: {
                html: "Search records",
                classes: "govuk-label--s"
              },
              id: "search",
              name: "search",
              value: query.search
            }) }}
            {{ govukButton({
              text: "Search"
            }) }}
          </div>

        </form>

        <div>

          {% if filteredRecords.length %}

            <div class="app-application-cards">
              {% set sortedFilterRecords = filteredRecords | sort(attribute="updatedDate") | reverse %}

              {% set draftRecords = sortedFilterRecords | filterAttr("status", "Draft") %}
             
              {% if (draftRecords | length) %}
                <div class="govuk-!-margin-bottom-8">
                  
                  <h2 class="govuk-heading-m">Draft records ({{draftRecords | length}})</h2>
                  {% for record in draftRecords %}
                    {% include "_includes/trainee-record-card.njk" %}
                  {% endfor %}
                </div>
              {% endif %}

              {% set nonDraftRecords = sortedFilterRecords | removeAttr("status", "Draft") %}
              {% if (nonDraftRecords | length) %} 
                <h2 class="govuk-heading-m">Records ({{nonDraftRecords | length}})</h2>
                {% for record in nonDraftRecords %}

                    {% include "_includes/trainee-record-card.njk" %}

                {% endfor %}
              {% endif %}

              

            </div>

            {# Don't show pagination when it's clear there's not many results #}
            {% if filteredRecords | length > 20 %}
              {% set pagination = {
                from: 1,
                to: 50,
                count: 346,
                next: {
                  text: 'Next',
                  href: '?page=' + 2
                },
                items: [{
                  text: '1',
                  href: '?page=1',
                  selected: true
                  }, {
                  text: '2',
                  href: '?page=2',
                  selected: false
                  }, {
                  text: '3',
                  href: '?page=3'
                  }]
              } %}

              {{ mojPagination({
                results: {
                  from: pagination.from,
                  to: pagination.to,
                  count: pagination.count
                },
                previous: pagination.previous,
                next: pagination.next,
                items: pagination.items,
                classes: 'govuk-!-margin-bottom-3'
              }) }}
            {% endif %}

          {% else %}
            <p class="govuk-body">No records found. Try <a href="#">clearing your filters</a>.</p>
          {% endif %}

          <p class="govuk-body"><a href="#" class="govuk-link">Export these records</a></p>
        </div>

      </div>
    </div>

  </div>

</div>

{% endblock %}

{% block pageScripts %}
  <script>
    new MOJFrontend.FilterToggleButton({
    bigModeMediaQuery: '(min-width: 48.063em)',
    startHidden: false,
    toggleButton: {
      container: $('.moj-action-bar__filter'),
      showText: 'Show filter',
      hideText: 'Hide filter',
      classes: 'govuk-button--secondary govuk-!-margin-bottom-0'
    },
    closeButton: {
      container: $('.moj-filter__header-action'),
      text: 'Close'
    },
    filter: {
      container: $('.moj-filter')
    }
  });
  </script>
{% endblock %}
