{% extends "layout.html" %}

{% set navActive = "records" %}

{% if not backLink %}
    {% set backLink      = 'javascript:history.back();' %}
{% endif %}
{% if not backText %}
    {% set backText      = 'Back'  %}
{% endif %}

{% if backLink == 'false' %}
    {% set backLink = false %}
{% endif %}

{% if backText == 'false' %}
    {% set backText = '' %}
{% endif %}


{% block pageTitle %}
  {{ pageHeading }} - {{serviceName}} - GOV.UK
{% endblock %}

{% block pageNavigation %}
  {% if backLink %}
    {{ govukBackLink({
      text: backText,
      href: backLink
    }) }}
  {% endif %}
{% endblock %}

{# Record could be set by locals, or in session data #}
{% set record = record or data.record %}
{% if not record %}
  {% set record = {} %}
{% endif %}



{% set canAmend = record.status | getAmendsAllowed %}
{# {% set showIncomplete = true %} #}


{# Used by summary cards #}
{% set recordPath = "/record/" + record.id %}
{% set referrer = recordPath %}

{% block content %}

  {% include "_includes/app-flash-message.html" %}

  <div class="record-header">
    <h1 class="govuk-heading-xl govuk-!-margin-bottom-0">
      {{pageHeading}}
      {{govukTag({
          text: record.status,
          classes: record.status | getStatusClass
      })}}
    </h1>
    {% if record.trn %}
      <span class="govuk-caption-l">TRN: {{record.trn}}
      </span>
    {% endif %}
  </div>

  {# <div class="govuk-error-summary govuk-error-summary--advisory" aria-labelledby="error-summary-title" role="alert" tabindex="-1" data-module="govuk-error-summary">
    <h2 class="govuk-error-summary__title" id="error-summary-title">
      You need to provide more details before recording an outcome
    </h2>
    <div class="govuk-error-summary__body">
      <ul class="govuk-list govuk-error-summary__list">
        <li>
          <a herf="">Confirm placement details are complete</a>
        </li>      
        <li>
          <a herf="">Provide a start date</a>
        </li>      
      </ul>
    </div>
  </div> #}

  {% set placementCount = record.placement.items | length %}
  {% set hasCommencementDate = record.trainingDetails.traineeStarted | falsify %}

  {# if there are placements #}
  {% if placementCount == 0 %}
    {{ govukErrorSummary({
      titleText: "You need to provide more details before recording an outcome",
      classes: "govuk-error-summary--advisory",
      errorList: [
      {
          text: "Add placement details",
          href: recordPath + 'placements/check-for-placements'
        }
      ]
    }) }}
  {# if there are placements #}
  {% elseif placementCount > 0 %}
    {{ govukErrorSummary({
      titleText: "You need to provide more details before recording an outcome",
      classes: "govuk-error-summary--advisory",
      errorList: [
        {
          text: "Confirm placement details are complete",
          href: "/placements/confirm"
        }
      ]
    }) }}

  {# if there are placements and the trainee hasnt started #}
  {% elseif placementCount > 0 and not hasCommencementDate %}
    {{ govukErrorSummary({
      titleText: "You need to provide more details before recording an outcome",
      classes: "govuk-error-summary--advisory",
      errorList: [
        {
          text: "Confirm placement details are complete",
          href: "recordPath + 'placements/confirm' | addReferrer(referrer)"
        },
        {
          text: "Provide a start date",
          href: "recordPath + '/trainee-start-date' | addReferrer(referrer)"
        }
      ]
    }) }}

  {# if there are no placements and the trainee hasnt started #}
  {% elseif placementCount == 0 and traineeStarted == "false" %}
    {{ govukErrorSummary({
      titleText: "You need to provide more details before recording an outcome",
      classes: "govuk-error-summary--advisory",
      errorList: [
        {
          text: "Add placement details",
          href: "recordPath + 'placements/check-for-placements' | addReferrer(referrer)"
        },
        {
          text: "Provide a start date",
          href: "recordPath + '/trainee-start-date' | addReferrer(referrer)"
        }
      ]
    }) }}
  {% endif %}

  {% include "_includes/record-sub-nav.njk" %}

  {% block tabContent %}
  
  {% endblock %}
    
{% endblock %}


